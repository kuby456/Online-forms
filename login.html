<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×”×ª×—×‘×¨×•×ª</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
   body {
font-family: Arial, sans-serif;
background: linear-gradient(to bottom, #f4f7fa, #e1e8f0);
height: 100vh;
display:flex;
justify-content:center;
align-items:center;
margin:0;
}

.card {
background:#fff;
padding:32px;
border-radius:16px;
box-shadow:0 10px 30px rgba(0,0,0,.2);
text-align:center;
width:340px;
animation:fadeIn .5s ease;
}

h1 {
margin-bottom:25px;
color:#1f8199;
}

button {
width:100%;
padding:14px;
border:none;
border-radius:10px;
font-size:16px;
font-weight:bold;
cursor:pointer;
display:flex;
align-items:center;
justify-content:center;
gap:10px;
transition:.25s;
}

#google-login {
background:#000000;
color:white;
width: 70%;
margin: auto;
}

#google-login:hover {
background:#357ae8;
}

.register-btn {
background:#1f8199;
color:white;
margin-top:10px;
}

.register-btn:hover {
background:#186677;
}

input {
width:100%;
padding:12px;
border-radius:8px;
border:1px solid #ccc;
margin-bottom:12px;
font-size:14px;
}

input:focus {
outline:none;
border-color:#1f8199;
box-shadow:0 0 0 2px rgba(31,129,153,.15);
}

.switch, .back {
margin-top:30px;
font-size:18px;
color:#1f8199;
cursor:pointer;
}

.switch:hover,.back:hover {
text-decoration:underline;
}

@keyframes fadeIn {
from{opacity:0;transform:translateY(20px)}
to{opacity:1;transform:none}
}
.note {
  margin-top: 15px;
  font-size: 13px;          /* ×§×˜×Ÿ ×•×¢×“×™×Ÿ */
  color: #888;             /* ××¤×•×¨ ×¨×š */
  line-height: 1.4;
  opacity: 0.8;
  user-select: none;       /* ×©×œ× ×™×™×‘×—×¨ ×‘×˜×¢×•×ª */
}
#register-form {
  display: none;
  margin-top: 20px;
  animation: registerFade .4s ease forwards;
 
}

/* ×©×“×•×ª */
#register-form input {
  width: 90%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
  text-align: right;
  transition: border .2s, box-shadow .2s;
}

#register-form input:focus {
  outline: none;
  border-color: #1f8199;
  box-shadow: 0 0 0 2px rgba(31,129,153,.2);
}

/* ×›×¤×ª×•×¨ ×”×¨×©××” */
.register-btn {
  background: linear-gradient(135deg,#1f8199,#3ba2b9);
  color: white;
  margin-top: 5px;
  border-radius: 12px;
}

.register-btn:hover {
  background: linear-gradient(135deg,#186677,#2f8fa4);
}

/* ×—×–×¨×” */
.back {
  margin-top: 15px;
  font-size: 13px;
  color: #1f8199;
  cursor: pointer;
  opacity: .8;
}

.back:hover {
  text-decoration: underline;
}

/* ×× ×™××¦×™×™×ª ×›× ×™×¡×” */
@keyframes registerFade {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: none;
  }
}

#error-box {
  color: #d93025;
  font-size: 12px;
  margin-bottom: 10px;
  display: none;
}

#login-form {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin-top: 10px;
}

/* ×©×“×•×ª */
#login-form input {
  width: 70%;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;

  text-align: right;      /* ×›×ª×™×‘×” ××™××™×Ÿ */
  direction: rtl;

  transition: border .2s, box-shadow .2s;
}

/* placeholder ×‘××¨×›×– */
#login-form input::placeholder {
  text-align: center;
  direction: rtl;
}


#login-form input:focus {
  outline: none;
  border-color: #1f8199;
  box-shadow: 0 0 0 2px rgba(31,129,153,.2);
}

/* ×›×¤×ª×•×¨ ×”×ª×—×‘×¨×•×ª */
#login-form button {
  border: solid 2px rgb(113, 113, 114);
  color: rgb(0, 0, 0);
  border-radius: 12px;
  width: 25%;
  background-color: white;
  margin-bottom: 50px;
  padding: 10px;
}

#login-form button:hover {
  background: linear-gradient(135deg,#186677,#2f8fa4);
}

/* ×§×™×©×•×¨ ×”×¨×©××” */
#login-form .switch {
  margin-top: 8px;
  font-size: 13px;
  color: #1f8199;
  cursor: pointer;
  opacity: .85;
}

#login-form .switch:hover {
  text-decoration: underline;
}

  </style>
</head>

<body>

  <div class="card">

<h1 id="title">×”×ª×—×‘×¨×•×ª</h1>
<form id="login-form">

<input type="email" id="login-email" placeholder="ğŸ“§ ××™××™×™×œ" required>

<input type="password" id="login-password" placeholder="ğŸ” ×¡×™×¡××”" required>
<div id="error-box"></div>

<button type="submit">×”×ª×—×‘×¨</button>
</form>

<!-- GOOGLE -->
<button id="google-login">
<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
×”××©×š ×¢× Google
</button>

<div class="switch" onclick="showRegister()">
× ×¨×©× ×—×“×©? ×œ×—×¥ ×›××Ÿ
</div>

<!-- REGISTER FORM -->
<form id="register-form" style="display:none;">

<input type="email" id="email" placeholder="ğŸ“§ ××™××™×™×œ â€“ ×–×” ×™×”×™×” ×©× ×”××©×ª××© ×©×œ×š" required>

<div style="position:relative">
<input type="password" id="password" placeholder="ğŸ” ×‘×—×¨ ×¡×™×¡××”" required>
<span onclick="togglePass('password')" style="position:absolute;left:10px;top:12px;cursor:pointer">ğŸ‘</span>
</div>

<div style="position:relative">
<input type="password" id="confirm-password" placeholder="ğŸ” ××©×¨ ×¡×™×¡××”" required>
<span onclick="togglePass('confirm-password')" style="position:absolute;left:10px;top:12px;cursor:pointer">ğŸ‘</span>
</div>

<button type="submit" class="register-btn">×¦×•×¨ ×—×©×‘×•×Ÿ</button>

<div class="back" onclick="backToLogin()">×—×–×¨×”</div>

</form>

<div class="note">
      ×”×”×ª×—×‘×¨×•×ª ××ª×‘×¦×¢×ª ×‘×¦×•×¨×” ×××•×‘×˜×—×ª ×“×¨×š <br>Google  
    </div>
</div>

    
 

  
  <script>
  // ğŸ” ×—×™×‘×•×¨ ×œ-Supabase (×¨×§ ×¤×¢× ××—×ª!)
  const supabaseClient = supabase.createClient(
    'https://obhhrcjvjoyurwfoukqr.supabase.co',
    'sb_publishable_tSE7k5N9Qmfg2LeSyHTErg_FZgBoSrT'
  );

  // ğŸ”‘ ×”×ª×—×‘×¨×•×ª ×¢× Google
  document.getElementById('google-login').onclick = async () => {
    await supabaseClient.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: window.location.origin + '/index.html'
      }
    });
  };

  // ×× ×”××©×ª××© ×›×‘×¨ ××—×•×‘×¨ â€“ ××¢×‘×™×¨×™× ××•×ª×•
  supabaseClient.auth.getSession().then(({ data }) => {
  if (data.session) {
  window.location.href = 'index.html';
}
  });



  // ×“×•×’××” ×œ×§×¨×™××” ×œ×¤×¨×•×¤×™×œ
  async function getProfile() {
    const { data: { session } } = await supabaseClient.auth.getSession();
    if (!session) return null;

    const userId = session.user.id;
    const { data, error } = await supabaseClient
      .from('profiles')
      .select('*')
      .eq('id', userId)
      .single();

    if (error) console.error(error);
    return data;
  }

  getProfile().then(profile => {
    if(profile){
      console.log('×¤×¨×˜×™ ×”××©×ª××©:', profile);
    }
  });


function showError(msg){
  const box = document.getElementById("error-box");
  box.innerText = msg;
  box.style.display = "block";
}

function clearError(){
  document.getElementById("error-box").style.display="none";
}

// ××¢×‘×¨ ×œ×”×¨×©××”
function showRegister(){
  clearError();
  document.getElementById("login-form").style.display="none";
  document.getElementById("google-login").style.display="none";
  document.getElementById("register-form").style.display="block";
  document.getElementById("title").innerText="×”×¨×©××”";
}

// ×—×–×¨×” ×œ×”×ª×—×‘×¨×•×ª
function backToLogin(){
  location.reload();
}

// ============ LOGIN ×¢× ×¡×™×¡××” ============

document.getElementById("login-form").onsubmit = async (e)=>{
  e.preventDefault();
  clearError();

  const email = document.getElementById("login-email").value;
  const password = document.getElementById("login-password").value;

  const { error } = await supabaseClient.auth.signInWithPassword({
    email,
    password
  });

  if(error){
    showError("××™××™×™×œ ××• ×¡×™×¡××” ×©×’×•×™×™×");
    return;
  }

  window.location.href = "index.html";
};


// ============ REGISTER ============

document.getElementById("register-form").onsubmit = async (e)=>{
  e.preventDefault();
  clearError();

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const confirm = document.getElementById("confirm-password").value;

  if(!email){
    showError("× × ×œ×”×–×™×Ÿ ××™××™×™×œ");
    return;
  }

  if(password.length < 6){
    showError("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×");
    return;
  }

  if(password !== confirm){
    showError("âŒ ×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª");
    return;
  }

  const { error } = await supabaseClient.auth.signUp({
    email,
    password,
    options: {
      emailRedirectTo: window.location.origin + "/index.html"
    }
  });

  if(error){

    if(error.message.includes("already")){
      showError("×”××™××™×™×œ ×›×‘×¨ ×¨×©×•× â€” × ×¡×” ×œ×”×ª×—×‘×¨");
    }

    else if(error.message.includes("Password")){
      showError("×”×¡×™×¡××” ×—×œ×©×” ××“×™");
    }

    else{
      showError("××™×¨×¢×” ×©×’×™××”, × ×¡×” ×©×•×‘");
      console.error(error);
    }

    return;
  }

  // ×”×¦×œ×—×” â€” ××¦×™×’×™× ×”×•×“×¢×ª ××™××•×ª
  document.querySelector(".card").innerHTML = `
    <h2 style="color:#1f8199">ğŸ“¨ × ×©×œ×— ××™××•×ª ×œ××™×™×œ</h2>
    <p style="margin-top:15px;font-size:15px;line-height:1.6">
      ×©×œ×—× ×• ××œ×™×š ××™×™×œ ×¢× ×§×™×©×•×¨ ××™××•×ª.<br>
      ×œ×—×¥ ×¢×œ×™×• ×›×“×™ ×œ×”×¤×¢×™×œ ××ª ×”×—×©×‘×•×Ÿ.
    </p>
    <small style="opacity:.7">××¤×©×¨ ×œ×¡×’×•×¨ ××ª ×”×—×œ×•×Ÿ ×”×–×”.</small>
  `;
};

function togglePass(id){
  const el = document.getElementById(id);
  el.type = el.type === "password" ? "text" : "password";
}


</script>


</body>
</html>
